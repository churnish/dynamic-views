/* Fade-in animation for batch-appended cards */
/* Card spacing setting - Bases files only */
/* Grid uses row-gap for spacing; zero out card margins to prevent grid row inflation.
   Scoped to Bases to match specificity of the Bases-only card margin rules above. */
/* Clickable card cursor */
/* Masonry container */
/* Hide cards during layout recalc - fade out with opacity transition */
/* Works for both ungrouped (.masonry-container on same element) and grouped (nested .masonry-container) */
/* Hide end indicator during resize - use display:none to fully remove from flow */
/* Hide cards until masonry positions them (prevents flash at 0,0) */
/* Must match positioned cards' CSS context (position + containment) for accurate height measurement */
/* height: auto overrides grid's height: 100% which causes incorrect 148px skeleton height */
/* Masonry positioned cards */
/* Desktop: cards outside scrollport margin hidden by IO-based system */
/* Spacing between card-header and card-body inside .card-content */
/* Spacing between elements inside card-body (properties-top, previews, properties-bottom) */
/* Grid view: card-content fills available space, aligns children to top */
/* Grid view: title-group grows horizontally inside card-header to fill space beside URL icon */
.dynamic-views {
  .card.card-fade-in {
    animation: cardFadeIn var(--anim-duration-fast, 140ms) ease-out;
  }

  .card.clickable-card {
    cursor: pointer;
  }

  .masonry-container {
    position: relative;
    height: var(--masonry-height, auto);
    contain: layout style;
  }

  .masonry-container.masonry-resizing .card,
  .masonry-resizing .masonry-container .card {
    opacity: 0;
    visibility: hidden;
    transition:
      opacity var(--anim-duration-superfast, 70ms) ease,
      visibility 0s var(--anim-duration-superfast, 70ms);
  }

  &:has(.masonry-resizing) .dynamic-views-end-indicator {
    display: none;
  }

  .masonry-container .card:not(.masonry-positioned) {
    position: absolute;
    opacity: 0;
    height: auto;
    contain: layout style paint;
  }

  .card.masonry-positioned {
    position: absolute;
    contain: layout style paint;
    transition:
      opacity var(--anim-duration-superfast, 70ms) ease,
      top var(--anim-duration-fast, 140ms) ease,
      left var(--anim-duration-fast, 140ms) ease,
      box-shadow var(--anim-duration-fast, 140ms) ease-in-out,
      background-color var(--anim-duration-fast, 140ms) ease;
  }

  // Eased transition during post-resize correction and scroll remeasure —
  // 200ms must match MASONRY_CORRECTION_MS in shared/constants.ts
  .masonry-correcting .card.masonry-positioned {
    transition:
      opacity var(--anim-duration-superfast, 70ms) ease,
      top 200ms ease,
      left 200ms ease,
      box-shadow var(--anim-duration-fast, 140ms) ease-in-out,
      background-color var(--anim-duration-fast, 140ms) ease;
  }

  // Instant repositioning during scroll-idle remeasure — overrides base
  // 140ms transition so positions update in sync with scrollTop compensation
  .masonry-skip-transition .card.masonry-positioned {
    transition: none !important;
  }

  // During active resize, keep top/left/height transitions for smooth repositioning.
  // Per-frame JS cost is ~0.3ms after offset skip — budget for transition smoothing.
  // Width is NOT transitioned — left positions assume target width instantly.
  .masonry-resize-active .card.masonry-positioned {
    transition:
      opacity var(--anim-duration-superfast, 70ms) ease,
      top var(--anim-duration-fast, 140ms) ease,
      left var(--anim-duration-fast, 140ms) ease,
      height var(--anim-duration-fast, 140ms) ease,
      box-shadow var(--anim-duration-fast, 140ms) ease-in-out,
      background-color var(--anim-duration-fast, 140ms) ease;
  }

  .card.content-hidden {
    content-visibility: hidden;
    contain-intrinsic-height: auto 300px;
  }

  .card .card-content > * + * {
    margin-top: var(--size-4-2);
  }

  .card .card-body > * + * {
    margin-top: var(--size-4-2);
  }

  .dynamic-views-grid .card-previews {
    flex-grow: 1;
    align-items: flex-start;
  }

  .dynamic-views-grid .card-header .card-title-block {
    flex-grow: 1;
  }
}

@keyframes cardFadeIn {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

.workspace-leaf-content[data-type="bases"] .dynamic-views .card {
  margin: var(--dynamic-views-card-spacing-desktop, 8px) 0;
}

.is-mobile .workspace-leaf-content[data-type="bases"] .dynamic-views .card {
  margin: var(--dynamic-views-card-spacing-mobile, 6px) 0;
}

.workspace-leaf-content[data-type="bases"]
  .dynamic-views
  .dynamic-views-grid
  .dynamic-views-group
  > .card {
  margin-top: 0;
  margin-bottom: 0;
}

/* Card border color presets — set shared variable, consumed by ::after and cover-content divider */
/* Faint (default) — no rule needed, base uses --background-modifier-border */
body.dynamic-views-card-border-color-muted .dynamic-views .card {
  --card-border-color: var(--background-modifier-border-hover);
}
body.dynamic-views-card-border-color-normal .dynamic-views .card {
  --card-border-color: var(--background-modifier-border-focus);
}
body.dynamic-views-card-border-color-accent .dynamic-views .card {
  --card-border-color: var(--text-accent);
}
body.dynamic-views-card-border-color-red .dynamic-views .card {
  --card-border-color: var(--color-red);
}
body.dynamic-views-card-border-color-orange .dynamic-views .card {
  --card-border-color: var(--color-orange);
}
body.dynamic-views-card-border-color-yellow .dynamic-views .card {
  --card-border-color: var(--color-yellow);
}
body.dynamic-views-card-border-color-green .dynamic-views .card {
  --card-border-color: var(--color-green);
}
body.dynamic-views-card-border-color-cyan .dynamic-views .card {
  --card-border-color: var(--color-cyan);
}
body.dynamic-views-card-border-color-blue .dynamic-views .card {
  --card-border-color: var(--color-blue);
}
body.dynamic-views-card-border-color-purple .dynamic-views .card {
  --card-border-color: var(--color-purple);
}
body.dynamic-views-card-border-color-pink .dynamic-views .card {
  --card-border-color: var(--color-pink);
}
body.dynamic-views-card-border-color-transparent .dynamic-views .card {
  --card-border-color: transparent;
  --cover-inset-computed: var(--dynamic-views-cover-inset, 0px);
}
body.dynamic-views-card-border-color-transparent .dynamic-views .card::after {
  box-shadow: none;
}
body.dynamic-views-card-border-color-custom .dynamic-views .card {
  --card-border-color: var(
    --dynamic-views-card-border-color-custom,
    var(--background-modifier-border)
  );
}

/* Focus ring - appears after hiding rules to win via cascade */
body .dynamic-views .card:focus-visible::after {
  content: "";
  position: absolute;
  inset: 0;
  border-radius: inherit;
  box-shadow: inset 0 0 0 2px var(--background-modifier-border-focus);
  pointer-events: none;
  z-index: 10;
}

/* Mobile: browser-managed content-visibility (IO-based toggling causes
   infinite reflow loop on iOS WebKit) */
body.is-mobile .dynamic-views .card {
  content-visibility: auto;
  contain-intrinsic-height: auto 300px;
}

/* Force content rendering during masonry height measurement
   (overrides both IO-based .content-hidden and CSS content-visibility: auto) */
.masonry-measuring .card {
  content-visibility: visible !important;
}

/* Collapse card-content when it only has a hidden thumbnail placeholder */
body:not(.dynamic-views-show-thumbnail-placeholder)
  .dynamic-views
  .card-previews:has(> .card-thumbnail-placeholder:only-child) {
  display: none;
}

/* Card background options */
body.dynamic-views-card-background-transparent .dynamic-views .card {
  background-color: transparent;
}

body.dynamic-views-card-background-custom .dynamic-views .card {
  background-color: var(
    --dynamic-views-card-background-color-custom,
    var(--background-primary-alt)
  );
}

/* Card background on hover options */
@media (hover: hover) {
  body.dynamic-views-card-background-hover-tinted
    .dynamic-views
    .card.hover-intent-active:hover {
    background-color: var(--background-primary-alt);
  }

  body.dynamic-views-card-background-hover-transparent
    .dynamic-views
    .card.hover-intent-active:hover {
    background-color: transparent;
  }

  body.dynamic-views-card-background-hover-custom
    .dynamic-views
    .card.hover-intent-active:hover {
    background-color: var(
      --dynamic-views-card-background-color-hover-custom,
      var(--background-primary-alt)
    );
  }
}

/* Gate pointer cursor behind hover intent on desktop */
@media (hover: hover) {
  .dynamic-views .card:not(.hover-intent-active) {
    &.clickable-card {
      cursor: default;
    }

    .card-title a,
    .card-title .card-title-link {
      cursor: default;
    }

    .property a {
      cursor: default;
    }

    .folder-segment,
    .filename-segment {
      cursor: default;
    }
  }

  /* Tags: higher specificity needed (base rule uses body:not() selectors) */
  .dynamic-views
    .card:not(.hover-intent-active)
    :is(.card-properties, .card-subtitle)
    .tag {
    cursor: default;
  }

  /* Poster cards: higher specificity needed (base rule uses body class selector) */
  body.dynamic-views-open-on-card
    .dynamic-views
    .card:not(.hover-intent-active).image-format-poster:has(.card-poster) {
    cursor: default;
  }

  /* Text cursor: higher specificity needed (base rule uses body.dynamic-views-open-on-title) */
  body.dynamic-views-open-on-title
    .dynamic-views
    .card:not(.hover-intent-active) {
    .card-text-preview,
    .card-title,
    .card-subtitle,
    .property-label,
    .property-label-inline,
    .property-content {
      cursor: default;
    }
  }
}

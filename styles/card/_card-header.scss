/* Extension suffix element (hidden by default, shown in Extension mode) */
.dynamic-views {
  .card .card-header {
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    gap: var(--size-4-2);
  }

  .card-title-block {
    display: flex;
    flex-direction: column;
    flex: 1 1 0;
    min-width: 0;
  }

  .card-title {
    font-weight: calc(var(--font-weight) + var(--bold-modifier));
    color: var(--dynamic-views-title-color, var(--text-normal));
    font-family: var(--dynamic-views-title-font, inherit);
    font-size: var(--dynamic-views-title-font-size, var(--font-ui-medium));
    max-width: 100%;
    word-break: break-word;
    text-align: left;
    margin: 0;
    line-height: var(--line-height-tight);
    display: -webkit-box;
    -webkit-line-clamp: var(--dynamic-views-title-lines, 2);
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .card-title-ext-suffix {
    display: none;
  }
}

/* Extension mode: use max-height for JS truncation measurement */
body.dynamic-views-file-type-ext .dynamic-views .card-title {
  display: block;
  -webkit-line-clamp: unset;
  -webkit-box-orient: unset;
  max-height: calc(
    var(--dynamic-views-title-lines, 2) * 1em * var(--line-height-tight)
  );
}

/* Show extension suffix inline in Extension mode */
body.dynamic-views-file-type-ext .dynamic-views .card-title-ext-suffix {
  display: inline;
  opacity: 0.6;
  font-weight: normal;
}

/* Extension inside link - use color-mix for text, underline only on hover */
body.dynamic-views-file-type-ext
  .dynamic-views
  .card-title
  a
  .card-title-ext-suffix {
  display: inline;
  opacity: 1;
  color: color-mix(in srgb, currentColor 60%, transparent);
  font-weight: normal;
  text-decoration: none;
}

/* Poster: hover bg adapts to forced text color (no card background for --background-modifier-hover) */
/* When URL icon is only child (no title/subtitle), push to right */
/* File type indicator styles */
.dynamic-views {
  .card-title-url-icon {
    flex-shrink: 0;
    /* Compensate for wrapper padding: (26px wrapper - 18px icon) / 2 = 4px */
    margin: -4px;
    /* Extra -1px aligns URL icon top with slideshow indicator edge distance */
    margin-top: -5px;
  }

  .card-title-url-icon svg {
    width: 20px;
    height: 20px;
  }
}

@media (hover: hover) {
  .dynamic-views .card.image-format-poster.hover-intent-active .card-title-url-icon:hover {
    background-color: color-mix(in srgb, currentColor 20%, transparent);
    border-radius: var(--radius-s);
  }
}

.dynamic-views {
  .card-header .card-title-url-icon:only-child {
    margin-left: auto;
  }

  .card-title-ext {
    display: none;
  }

  .card-title-icon {
    float: left;
    margin-right: var(--size-2-2);
    display: none;
  }

  .card-title-icon svg {
    width: 1em;
    height: calc(1em * var(--line-height-tight));
    vertical-align: bottom;
    color: var(--text-normal);
    stroke-width: var(--icon-xs-stroke-width);
  }
}

/* File type indicator: Flair (box before title) */
body.dynamic-views-file-type-flair .dynamic-views .card-title-ext {
  display: flex;
  align-items: center;
  height: calc(
    var(--dynamic-views-title-font-size, var(--font-ui-medium)) *
      var(--line-height-tight)
  );
  font-size: 0;
  pointer-events: none;
  cursor: default;
  float: left;
  margin-right: var(--size-2-2);
}

body.dynamic-views-file-type-flair .dynamic-views .card-title-ext::before {
  content: attr(data-ext);
  color: var(--text-muted);
  font-family: var(--font-interface, var(--font-text));
  font-size: var(--font-ui-smaller);
  line-height: var(--dynamic-views-title-font-size, var(--font-ui-medium));
  padding: 0 0.33em 0 0.38em; /* Extra 0.05em left to offset letter-spacing trailing space */
  border-radius: var(--radius-s);
  background-color: var(--background-modifier-border);
  font-weight: var(--nav-tag-weight);
  letter-spacing: 0.05em;
  text-transform: uppercase;
}

/* File type indicator: Icon */
body.dynamic-views-file-type-icon .dynamic-views .card-title-ext {
  display: none;
}

body.dynamic-views-file-type-icon .dynamic-views .card-title-icon {
  display: block;
  pointer-events: none;
  cursor: default;
}

/* File type indicator: None */
body.dynamic-views-file-type-none .dynamic-views .card-title-ext,
body.dynamic-views-file-type-none .dynamic-views .card-title-icon {
  display: none;
}

/* Dim on touch/press for visual feedback (matches Bases backend <a> tag behavior) */
.dynamic-views {
  .card-title a,
  .card-title .card-title-link {
    text-decoration: none;
    color: inherit;
    font-weight: inherit;
    cursor: pointer;
    /* Match Bases backend <a> tag transition for consistent touch feedback */
    transition: opacity var(--anim-duration-fast) ease-in-out;
  }

  .card-title .card-title-link:active {
    opacity: 0.5;
  }
}

@media (hover: hover) {
  /* Underline title on hover when open action is "press on title" */
  body.dynamic-views-open-on-title
    .dynamic-views
    .card.hover-intent-active
    .card-title
    :is(a, .card-title-link):hover {
    text-decoration: underline;
    color: var(--text-normal);
  }

  /* Extension suffix underline on hover */
  body.dynamic-views-file-type-ext
    .dynamic-views
    .card.hover-intent-active
    .card-title
    :is(a, .card-title-link):hover
    .card-title-ext-suffix {
    text-decoration: underline;
    text-decoration-color: var(--dynamic-views-title-color, var(--text-normal));
  }
}

/* Subtitle property content inherits color from subtitle (exclude links) */
/* Subtitle property-content: use line-height instead of fixed min-height */
.dynamic-views {
  .card-subtitle {
    color: var(--text-faint);
    font-family: var(--dynamic-views-subtitle-font);
    font-size: var(--dynamic-views-subtitle-font-size, var(--font-ui-small));
    max-width: 100%;
    word-break: break-word;
    text-align: left;
    margin: 0;
    display: block;
    overflow: hidden;
    line-height: var(--line-height-tight);
  }

  .card-subtitle .property-content,
  .card-subtitle .property-content *:not(.internal-link, .external-link, a) {
    color: inherit;
  }

  .card-subtitle .property-content {
    min-height: 0;
  }
}

/* Subtitle bold */
body.dynamic-views-subtitle-bold .dynamic-views .card-subtitle {
  font-weight: calc(var(--font-weight) + var(--bold-modifier));
}

/* Subtitle italic */
body.dynamic-views-subtitle-italic .dynamic-views .card-subtitle {
  font-style: italic;
}

/* Subtitle small caps */
body.dynamic-views-subtitle-small-caps .dynamic-views .card-subtitle {
  font-variant: small-caps;
}

/* Subtitle alignment */
body.dynamic-views-subtitle-align-center .dynamic-views .card-subtitle {
  text-align: center;
}

body.dynamic-views-subtitle-align-right .dynamic-views .card-subtitle {
  text-align: right;
}

/* Subtitle wrap mode (default) - override property-content-wrapper's overflow */
/* Allow path-wrapper to wrap in subtitle */
/* Allow path segments to word-break in subtitle */
.dynamic-views {
  .card-subtitle .property-content-wrapper {
    overflow: hidden;
    flex-wrap: wrap;
  }
}

body:not(.dynamic-views-subtitle-overflow-scroll)
  .dynamic-views
  .card-subtitle
  .path-wrapper {
  height: auto;
  white-space: normal;
  flex-wrap: wrap;
}

body:not(.dynamic-views-subtitle-overflow-scroll)
  .dynamic-views
  .card-subtitle
  .path-segment {
  white-space: normal;
  overflow-wrap: break-word;
}

.dynamic-views {
  .card-subtitle
    :is(
      .property-content,
      .text-wrapper,
      .text-wrapper > span:not(.internal-link, .external-link, .tag)
    ) {
    display: block;
    width: 100%;
    height: auto;
    word-break: break-word;
  }
}

/* Subtitle wrap: override white-space: pre from text-wrapper span rule (needs higher specificity) */
body:not(.dynamic-views-subtitle-overflow-scroll)
  .dynamic-views
  .card-subtitle
  .text-wrapper
  > span:not(.internal-link):not(.external-link):not(.tag) {
  white-space: normal;
}

/* Disable fade gradient in wrap mode */
body:not(.dynamic-views-subtitle-overflow-scroll)
  .dynamic-views
  .card-subtitle
  .property-content-wrapper:is(
    .scroll-gradient-left,
    .scroll-gradient-right,
    .scroll-gradient-both
  ) {
  mask-image: none !important;
  -webkit-mask-image: none !important;
}

/* Subtitle scroll mode */
body.dynamic-views-subtitle-overflow-scroll .dynamic-views .card-subtitle {
  display: block;
  -webkit-line-clamp: unset;
  -webkit-box-orient: unset;
  white-space: nowrap;
  overflow-x: auto;
  scrollbar-width: none;
}

body.dynamic-views-subtitle-overflow-scroll
  .dynamic-views
  .card-subtitle
  .property-content-wrapper {
  overflow-x: auto;
  flex-wrap: nowrap;
}

body.dynamic-views-subtitle-overflow-scroll
  .dynamic-views
  .card-subtitle
  :is(
    .property-content,
    .text-wrapper,
    .text-wrapper > span:not(.internal-link, .external-link, .tag)
  ) {
  display: flex;
  width: max-content;
  white-space: nowrap;
}

/* Title divider line (shown when class-toggle is ON) */
/* Only show divider when card has content below title (excludes cover-bottom-only cards) */
body.dynamic-views-title-divider
  .dynamic-views
  .card:has(.card-previews, .card-properties-top, .card-properties-bottom)
  .card-header {
  padding-bottom: var(--size-4-2);
  border-bottom: 1px solid var(--background-modifier-border);
}

/* Subtitle above title - flip visual order with CSS order */
body.dynamic-views-subtitle-above .dynamic-views .card-title-block .card-title {
  order: 2;
}
body.dynamic-views-subtitle-above
  .dynamic-views
  .card-title-block
  .card-subtitle {
  order: 1;
}

.dynamic-views {
  .card-previews {
    display: flex;
    flex-direction: row;
    gap: var(--size-4-2);
  }
}
